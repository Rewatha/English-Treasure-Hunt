<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results - English Treasure Hunt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }

        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti {
            animation: confetti 3s ease-in-out infinite;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect } = React;

        // Icons
        const Trophy = () => (
            React.createElement('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "80",
                height: "80",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2"
            },
                React.createElement('path', { d: "M6 9H4.5a2.5 2.5 0 0 1 0-5H6" }),
                React.createElement('path', { d: "M18 9h1.5a2.5 2.5 0 0 0 0-5H18" }),
                React.createElement('path', { d: "M4 22h16" }),
                React.createElement('path', { d: "M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" }),
                React.createElement('path', { d: "M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" }),
                React.createElement('path', { d: "M18 2H6v7a6 6 0 0 0 12 0V2Z" })
            )
        );

        const Clock = () => (
            React.createElement('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                style: { display: 'inline' }
            },
                React.createElement('circle', { cx: "12", cy: "12", r: "10" }),
                React.createElement('polyline', { points: "12 6 12 12 16 14" })
            )
        );

        const Award = () => (
            React.createElement('svg', {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                style: { display: 'inline' }
            },
                React.createElement('circle', { cx: "12", cy: "8", r: "6" }),
                React.createElement('path', { d: "M15.477 12.89 17 22l-5-3-5 3 1.523-9.11" })
            )
        );

        function ResultsPage() {
            const [playerName, setPlayerName] = useState('');
            const [studentNumber, setStudentNumber] = useState('');
            const [attemptData, setAttemptData] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                try {
                    const currentPlayer = localStorage.getItem('currentPlayer');
                    if (!currentPlayer) {
                        window.location.href = 'index.html';
                        return;
                    }

                    const player = JSON.parse(currentPlayer);
                    setPlayerName(player.name);
                    setStudentNumber(player.gmail);

                    // Load attempt data
                    const lastAttempt = localStorage.getItem('lastAttempt');
                    if (!lastAttempt) {
                        window.location.href = 'index.html';
                        return;
                    }

                    const attempt = JSON.parse(lastAttempt);
                    setAttemptData(attempt);
                    setLoading(false);
                } catch (e) {
                    window.location.href = 'index.html';
                }
            }, []);

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const handleHome = () => {
                // Clear completion flags
                localStorage.removeItem('picturePuzzleCompleted');
                localStorage.removeItem('riddleChallengeCompleted');
                localStorage.removeItem('lastAttempt');

                // Go back to login
                window.location.href = 'index.html';
            };

            const handleViewHistory = () => {
                alert('View history feature coming soon!');
            };

            if (loading) {
                return React.createElement('div', {
                    className: "min-h-screen bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-800 flex items-center justify-center"
                },
                    React.createElement('div', { className: "text-white text-2xl" }, 'Loading results...')
                );
            }

            const isComplete = attemptData.completed;
            const envelopesCompleted = attemptData.envelopesCompleted || 0;
            const timeTaken = attemptData.timeTaken || 0;
            const hintsUsed = attemptData.totalHintsUsed || 0;
            const skipsUsed = attemptData.totalSkipsUsed || 0;

            // Calculate remaining time (started with 480 seconds = 8 minutes)
            const timeRemaining = Math.max(0, 480 - timeTaken);

            return React.createElement('div', {
                className: "min-h-screen bg-gradient-to-br from-" + (isComplete ? "yellow-400 via-orange-500 to-red-500" : "gray-600 via-gray-700 to-gray-800") + " p-4"
            },
                React.createElement('div', { className: "max-w-3xl mx-auto py-8" },
                    // Confetti for winners
                    isComplete && React.createElement('div', { className: "fixed inset-0 pointer-events-none overflow-hidden" },
                        [...Array(20)].map((_, i) =>
                            React.createElement('div', {
                                key: i,
                                className: "confetti absolute text-4xl",
                                style: {
                                    left: `${Math.random() * 100}%`,
                                    animationDelay: `${Math.random() * 2}s`,
                                    animationDuration: `${3 + Math.random() * 2}s`
                                }
                            }, ['üéâ', 'üéä', '‚≠ê', '‚ú®', 'üèÜ'][Math.floor(Math.random() * 5)])
                        )
                    ),

                    // Main Results Card
                    React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl p-8 mb-6" },
                        // Header
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { className: "mb-6 flex justify-center " + (isComplete ? 'animate-bounce' : '') },
                                React.createElement(Trophy)
                            ),
                            React.createElement('h1', { className: "text-5xl font-bold mb-4 " + (isComplete ? "text-yellow-600" : "text-gray-700") },
                                isComplete ? 'üéâ TREASURE FOUND!' : '‚è±Ô∏è Time\'s Up!'
                            ),
                            React.createElement('p', { className: "text-2xl text-gray-700 font-semibold mb-2" },
                                playerName
                            ),
                            React.createElement('p', { className: "text-sm text-gray-600" },
                                'Gmail: ' + studentNumber // studentNumber variable now holds the Gmail string
                            )
                        ),

                        // Results Summary
                        React.createElement('div', { className: "grid md:grid-cols-2 gap-6 mb-8" },
                            // Envelopes Completed
                            React.createElement('div', { className: "bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl p-6 text-center" },
                                React.createElement('div', { className: "text-6xl mb-3" }, 'üì¨'),
                                React.createElement('p', { className: "text-sm text-gray-600 mb-2" }, 'Envelopes Completed'),
                                React.createElement('p', { className: "text-5xl font-bold " + (envelopesCompleted === 5 ? "text-green-600" : "text-orange-600") },
                                    envelopesCompleted + '/5'
                                )
                            ),

                            // Time
                            React.createElement('div', { className: "bg-gradient-to-br from-purple-50 to-purple-100 rounded-2xl p-6 text-center" },
                                React.createElement('div', { className: "text-6xl mb-3" }, '‚è±Ô∏è'),
                                React.createElement('p', { className: "text-sm text-gray-600 mb-2" },
                                    isComplete ? 'Time Remaining' : 'Time Used'
                                ),
                                React.createElement('p', { className: "text-5xl font-bold text-purple-600" },
                                    isComplete ? formatTime(timeRemaining) : formatTime(timeTaken)
                                )
                            ),

                            // Hints Used
                            React.createElement('div', { className: "bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-2xl p-6 text-center" },
                                React.createElement('div', { className: "text-6xl mb-3" }, 'üí°'),
                                React.createElement('p', { className: "text-sm text-gray-600 mb-2" }, 'Hints Used'),
                                React.createElement('p', { className: "text-5xl font-bold text-yellow-600" },
                                    hintsUsed
                                ),
                                React.createElement('p', { className: "text-xs text-gray-500 mt-2" },
                                    hintsUsed > 0 ? `(-${hintsUsed} minutes)` : 'No hints used!'
                                )
                            ),

                            // Skips Used
                            React.createElement('div', { className: "bg-gradient-to-br from-orange-50 to-orange-100 rounded-2xl p-6 text-center" },
                                React.createElement('div', { className: "text-6xl mb-3" }, '‚è≠Ô∏è'),
                                React.createElement('p', { className: "text-sm text-gray-600 mb-2" }, 'Question Skips Used'),
                                React.createElement('p', { className: "text-5xl font-bold text-orange-600" },
                                    skipsUsed + '/2'
                                ),
                                React.createElement('p', { className: "text-xs text-gray-500 mt-2" },
                                    skipsUsed > 0 ? `(-${skipsUsed * 30} seconds)` : 'No skips used!'
                                )
                            )
                        ),

                        // Performance Message
                        React.createElement('div', {
                            className: "rounded-2xl p-6 mb-6 text-center " + (
                                isComplete && envelopesCompleted === 5 ? "bg-green-100 border-2 border-green-300" :
                                    envelopesCompleted >= 3 ? "bg-blue-100 border-2 border-blue-300" :
                                        "bg-orange-100 border-2 border-orange-300"
                            )
                        },
                            React.createElement('h3', { className: "text-2xl font-bold text-gray-800 mb-3" },
                                isComplete && envelopesCompleted === 5 ? 'üåü Perfect Score!' :
                                    envelopesCompleted >= 3 ? 'üëè Great Effort!' :
                                        'üí™ Keep Trying!'
                            ),
                            React.createElement('p', { className: "text-gray-700" },
                                isComplete && envelopesCompleted === 5 ?
                                    'Congratulations! You found the treasure and completed all 5 envelopes!' :
                                    envelopesCompleted >= 3 ?
                                        `Well done! You completed ${envelopesCompleted} out of 5 envelopes.` :
                                        `You completed ${envelopesCompleted} envelopes. Try again to improve your score!`
                            )
                        ),

                        // Prize Information
                        isComplete && envelopesCompleted === 5 && React.createElement('div', {
                            className: "bg-gradient-to-br from-yellow-200 to-orange-200 border-4 border-yellow-400 rounded-2xl p-8 mb-6 text-center"
                        },
                            React.createElement('div', { className: "text-6xl mb-4" }, 'üéÅ'),
                            React.createElement('h3', { className: "text-3xl font-bold text-gray-800 mb-4" },
                                'Claim Your Prize!'
                            ),
                            React.createElement('div', { className: "bg-white rounded-xl p-6 mb-4" },
                                React.createElement('p', { className: "text-lg text-gray-700 mb-3 font-semibold" },
                                    'üéâ Show this screen to the Game Master to receive:'
                                ),
                                React.createElement('ul', { className: "text-left text-gray-700 space-y-2" },
                                    React.createElement('li', null, 'üç´ Mini chocolates'),
                                    React.createElement('li', null, 'üìñ English-themed bookmarks'),
                                    React.createElement('li', null, 'üèÖ "English Detective" badge')
                                )
                            ),
                            React.createElement('div', { className: "bg-purple-600 text-white px-6 py-3 rounded-xl inline-block font-bold text-xl" },
                                'WINNER CODE: ' + studentNumber.split('@')[0].toUpperCase()
                            )
                        ),

                        // Action Buttons
                        React.createElement('div', { className: "grid md:grid-cols-3 gap-4" },
                            React.createElement('button', {
                                onClick: handleHome,
                                className: "bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl hover:from-purple-600 hover:to-indigo-700 transform hover:scale-105 transition-all shadow-lg"
                            }, 'üè† Home'),

                            React.createElement('button', {
                                onClick: () => window.location.href = 'leaderboard.html',
                                className: "bg-gradient-to-r from-yellow-500 to-orange-600 text-white font-bold py-4 px-6 rounded-xl hover:from-yellow-600 hover:to-orange-700 transform hover:scale-105 transition-all shadow-lg"
                            }, 'üèÜ Leaderboard'),

                            React.createElement('button', {
                                onClick: () => window.print(),
                                className: "bg-gradient-to-r from-blue-500 to-cyan-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-600 hover:to-cyan-700 transform hover:scale-105 transition-all shadow-lg"
                            }, 'üñ®Ô∏è Print')
                        )
                    ),

                    // Footer
                    React.createElement('div', { className: "text-center text-white" },
                        React.createElement('p', { className: "text-lg mb-2" },
                            'üí° Proudly celebrating English Day through fun and learning!'
                        ),
                        React.createElement('p', { className: "text-sm opacity-75" },
                            'Team English Explorers'
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(ResultsPage));
    </script>
</body>

</html>